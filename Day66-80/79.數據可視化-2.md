## 數據可視化-2

本章我們嘗試用 matplotlib 來繪制一些高階統計圖表。正如前面所說的，大家可以通過 matplotlib 官方網站上提供的[文檔](https://matplotlib.org/stable/tutorials/index.html)和[示例](https://matplotlib.org/stable/gallery/index.html)來學習如何使用 matplotlib 並繪制出更加高級的統計圖表；尤其是在定制一些比較複雜的圖表時，我們建議大家直接找到官網提供的示例，然後只需要做出相應的修改，就可以繪制出自己想要的圖表。這種“拷貝+修改”的做法應該會大大提高你的工作效率，因為大多數時候，你的代碼跟官網上的代碼就僅僅是數據有差別而已，沒有必要去做重複乏味的事情。

### 氣泡圖

氣泡圖可以用來了解三個變量之間的關系，通過比較氣泡位置和大小來分析數據維度之間的相關性。例如在我們之前繪制的月收入和網購支出的散點圖中，我們已經發現了二者的正相關關系，如果我們引入第三個變量網購次數，那麼我們就需要使用氣泡圖來進行展示。

代碼：

```python
income = np.array([5550, 7500, 10500, 15000, 20000, 25000, 30000, 40000])
outcome = np.array([800, 1800, 1250, 2000, 1800, 2100, 2500, 3500])
nums = np.array([5, 3, 10, 5, 12, 20, 8, 10])

# 通過scatter函數的s參數和c參數分別控制面積和顏色
plt.scatter(income, outcome, s=nums * 30, c=nums, cmap='Reds')
# 顯示顏色條
plt.colorbar()
# 顯示圖表
plt.show()
```

輸出：

<img src="res/bubble_chart.png" style="zoom:50%;">

### 面積圖

面積圖又叫堆疊折線圖，是在折線圖的基礎上，對折線以下的區域進行顏色填充（展示面積），用於在連續間隔或時間跨度上展示數值，一般用來顯示趨勢和對比數值，不同顏色的填充可以讓多個面積塊之間的對比和趨勢更好的突顯。下面的例子中，我們用面積圖來展示從週一到週日花在睡覺、吃飯、工作和玩耍上的時間。

代碼：

```python
plt.figure(figsize=(8, 4))
days = np.arange(7)
sleeping = [7, 8, 6, 6, 7, 8, 10]
eating = [2, 3, 2, 1, 2, 3, 2]
working = [7, 8, 7, 8, 6, 2, 3]
playing = [8, 5, 9, 9, 9, 11, 9]
# 繪制堆疊折線圖
plt.stackplot(days, sleeping, eating, working, playing)
# 定制橫軸刻度
plt.xticks(days, labels=[f'星期{x}' for x in '一二三四五六日'])
# 定制圖例
plt.legend(['睡覺', '吃飯', '工作', '玩耍'], fontsize=10)
# 顯示圖表
plt.show()
```

輸出：

<img src="res/stacked_line_chart.png" style="zoom:50%;">

### 雷達圖

雷達圖通常用來比較多個定量數據，用於查看哪些變量具有相似的值。 雷達圖也可用於查看數據集中哪些變量的值比較低，哪些變量的值比較高，是顯示性能或表現的理想選擇。經常觀看籃球、足球比賽的讀者應該對雷達圖非常熟悉，例如在 NBA 的轉播中就經常使用雷達圖來展示球員的各項數據。雷達圖的本質折線圖，只不過將折線圖映射到了極坐標系。在繪制雷達圖時，需要讓折線閉合，簡單的說就是首尾相連，下面是繪制雷達圖的代碼。

代碼：

```python
labels = np.array(['速度', '力量', '經驗', '防守', '發球', '技術'])
# 馬龍和水谷隼的數據
malong_values = np.array([93, 95, 98, 92, 96, 97])
shuigu_values = np.array([30, 40, 65, 80, 45, 60])
angles = np.linspace(0, 2 * np.pi, labels.size, endpoint=False)
# 多加一條數據讓圖形閉合
malong_values = np.append(malong_values, malong_values[0])
shuigu_values = np.append(shuigu_values, shuigu_values[0])
angles = np.append(angles, angles[0])
# 創建畫佈
plt.figure(figsize=(4, 4), dpi=120)
# 創建坐標系
ax = plt.subplot(projection='polar')
# 繪圖和填充
plt.plot(angles, malong_values, color='r', linewidth=2, label='馬龍')
plt.fill(angles, malong_values, color='r', alpha=0.3)
plt.plot(angles, shuigu_values, color='g', linewidth=2, label='水谷隼')
plt.fill(angles, shuigu_values, color='g', alpha=0.2)
# 顯示圖例
ax.legend()
# 顯示圖表
plt.show()
```

輸出：

<img src="res/radar_chart.png" style="zoom:50%;">

### 玫瑰圖

玫瑰圖是映射在極坐標下的柱狀圖，由弗羅倫斯·南丁格爾（Florence Nightingale）所發明，當年是南丁格爾用來呈現戰地醫院季節性死亡率的一種圖表。由於半徑和面積的關系是平方的關系，南丁格爾玫瑰圖會將數據的比例大小誇大，尤其適合對比大小相近的數值，同時由於圓形有週期的特性，所以南丁格爾玫瑰圖也適用於表示一個週期內的時間概念，比如星期、月份。

代碼：

```python
group1 = np.random.randint(20, 50, 4)
group2 = np.random.randint(10, 60, 4)
x = np.array([f'A組-Q{i}' for i in range(1, 5)] + [f'B組-Q{i}' for i in range(1, 5)])
y = np.array(group1.tolist() + group2.tolist())
# 玫瑰花瓣的角度和寬度
theta = np.linspace(0, 2 * np.pi, x.size, endpoint=False)
width = 2 * np.pi / x.size
# 生成8種隨機顏色
colors = np.random.rand(8, 3)
# 將柱狀圖投影到極坐標
ax = plt.subplot(projection='polar')
# 繪制柱狀圖
plt.bar(theta, y, width=width, color=colors, bottom=0)
# 設置網格
ax.set_thetagrids(theta * 180 / np.pi, x, fontsize=10)
# 顯示圖表
plt.show()
```

輸出：

<img src="res/rose_chart.png" style="zoom:50%;">

### 3D圖表

matplotlib 還可以用於繪制3D圖，具體的內容大家可以參考官方文檔，下面我們用一段簡單的代碼為大家展示如何繪制3D圖表。

代碼：

```python
from mpl_toolkits.mplot3d import Axes3D

fig = plt.figure(figsize=(8, 4), dpi=120)
# 創建3D坐標系並添加到畫佈上
ax = Axes3D(fig, auto_add_to_figure=False)
fig.add_axes(ax)
x = np.arange(-2, 2, 0.1)
y = np.arange(-2, 2, 0.1)
x, y = np.meshgrid(x, y)
z = (1 - y ** 5 + x ** 5) * np.exp(-x ** 2 - y ** 2)
# 繪制3D曲面
ax.plot_surface(x, y, z)
# 顯示圖表
plt.show()
```

輸出：

<img src="res/3d_surface_chart.png" style="zoom:60%;">

需要指出的是， JupyterLab 中渲染的3D圖並不是真正的3D圖，因為你沒有辦法調整觀察者的視角，也沒有辦法旋轉或者縮放。如果想要看到真正的3D效果，需要在將圖表渲染到 Qt 窗口中，為此我們可以先安裝名為 PyQt6 的三方庫，如下所示。

```
%pip install PyQt6
```

然後，我們使用魔法指令讓 JupyterLab 將圖表渲染到 Qt 窗口中。

```
%matplotlib qt
```

在完成上面的操作後，我們可以重新運行剛才繪制3D圖的代碼，看到如下所示的窗口。在這個窗口中，我們可以通過鼠標對3D進行旋轉、縮放，我們有可以選中圖表的一部分數據進行觀測，是不是非常的酷。

<img src="res/3d_surface_chart_qt.png" style="zoom:50%;">
